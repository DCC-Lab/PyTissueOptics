
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://dcc-lab.github.io/PyTissueOptics/api/rayscattering/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../scene/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>RayScattering - PyTissueOptics</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#scattering-module" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="PyTissueOptics" class="md-header__button md-logo" aria-label="PyTissueOptics" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PyTissueOptics
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              RayScattering
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="deep-purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="deep-purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="PyTissueOptics" class="md-nav__button md-logo" aria-label="PyTissueOptics" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    PyTissueOptics
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    RayScattering
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    RayScattering
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering" class="md-nav__link">
    <span class="md-ellipsis">
      rayscattering
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.Direction" class="md-nav__link">
    <span class="md-ellipsis">
      Direction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Direction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.Direction.axis" class="md-nav__link">
    <span class="md-ellipsis">
      axis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.EnergyLogger" class="md-nav__link">
    <span class="md-ellipsis">
      EnergyLogger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EnergyLogger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.EnergyLogger.nDataPoints" class="md-nav__link">
    <span class="md-ellipsis">
      nDataPoints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.EnergyLogger.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.EnergyLogger.export" class="md-nav__link">
    <span class="md-ellipsis">
      export
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.EnergyLogger.filter" class="md-nav__link">
    <span class="md-ellipsis">
      filter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.EnergyLogger.getDataPoints" class="md-nav__link">
    <span class="md-ellipsis">
      getDataPoints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.EnergyLogger.getFiltered" class="md-nav__link">
    <span class="md-ellipsis">
      getFiltered
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.EnergyLogger.logDataPointArray" class="md-nav__link">
    <span class="md-ellipsis">
      logDataPointArray
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.EnergyType" class="md-nav__link">
    <span class="md-ellipsis">
      EnergyType
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.PointCloudStyle" class="md-nav__link">
    <span class="md-ellipsis">
      PointCloudStyle
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.ScatteringScene" class="md-nav__link">
    <span class="md-ellipsis">
      ScatteringScene
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ScatteringScene">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.ScatteringScene.getEstimatedIPP" class="md-nav__link">
    <span class="md-ellipsis">
      getEstimatedIPP
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.Stats" class="md-nav__link">
    <span class="md-ellipsis">
      Stats
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Stats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.Stats.getTransmittance" class="md-nav__link">
    <span class="md-ellipsis">
      getTransmittance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.ViewGroup" class="md-nav__link">
    <span class="md-ellipsis">
      ViewGroup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.Visibility" class="md-nav__link">
    <span class="md-ellipsis">
      Visibility
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scene/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Scene
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering" class="md-nav__link">
    <span class="md-ellipsis">
      rayscattering
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.Direction" class="md-nav__link">
    <span class="md-ellipsis">
      Direction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Direction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.Direction.axis" class="md-nav__link">
    <span class="md-ellipsis">
      axis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.EnergyLogger" class="md-nav__link">
    <span class="md-ellipsis">
      EnergyLogger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EnergyLogger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.EnergyLogger.nDataPoints" class="md-nav__link">
    <span class="md-ellipsis">
      nDataPoints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.EnergyLogger.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.EnergyLogger.export" class="md-nav__link">
    <span class="md-ellipsis">
      export
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.EnergyLogger.filter" class="md-nav__link">
    <span class="md-ellipsis">
      filter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.EnergyLogger.getDataPoints" class="md-nav__link">
    <span class="md-ellipsis">
      getDataPoints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.EnergyLogger.getFiltered" class="md-nav__link">
    <span class="md-ellipsis">
      getFiltered
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.EnergyLogger.logDataPointArray" class="md-nav__link">
    <span class="md-ellipsis">
      logDataPointArray
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.EnergyType" class="md-nav__link">
    <span class="md-ellipsis">
      EnergyType
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.PointCloudStyle" class="md-nav__link">
    <span class="md-ellipsis">
      PointCloudStyle
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.ScatteringScene" class="md-nav__link">
    <span class="md-ellipsis">
      ScatteringScene
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ScatteringScene">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.ScatteringScene.getEstimatedIPP" class="md-nav__link">
    <span class="md-ellipsis">
      getEstimatedIPP
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.Stats" class="md-nav__link">
    <span class="md-ellipsis">
      Stats
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Stats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.Stats.getTransmittance" class="md-nav__link">
    <span class="md-ellipsis">
      getTransmittance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.ViewGroup" class="md-nav__link">
    <span class="md-ellipsis">
      ViewGroup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pytissueoptics.rayscattering.Visibility" class="md-nav__link">
    <span class="md-ellipsis">
      Visibility
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="scattering-module">Scattering Module</h1>


<div class="doc doc-object doc-module">



<a id="pytissueoptics.rayscattering"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="pytissueoptics.rayscattering.Direction" class="doc doc-heading">
            <code>Direction</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>









              <details class="quote">
                <summary>Source code in <code>pytissueoptics/rayscattering/display/utils/direction.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Direction</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">X_POS</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">Y_POS</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">Z_POS</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">X_NEG</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">Y_NEG</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">Z_NEG</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">isSameAxisAs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span> <span class="o">%</span> <span class="mi">3</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">axis</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns an integer between 0 and 2 representing the x, y, or z axis, ignoring direction sign.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">%</span> <span class="mi">3</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">isNegative</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">3</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">isPositive</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isNegative</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sign</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isPositive</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="pytissueoptics.rayscattering.Direction.axis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">axis</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Returns an integer between 0 and 2 representing the x, y, or z axis, ignoring direction sign.</p>

    </div>

</div>






  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pytissueoptics.rayscattering.EnergyLogger" class="doc doc-heading">
            <code>EnergyLogger</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Logger (pytissueoptics.scene.logger.logger.Logger)" href="../scene/#pytissueoptics.scene.Logger">Logger</a></code></p>









              <details class="quote">
                <summary>Source code in <code>pytissueoptics/rayscattering/energyLogging/energyLogger.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EnergyLogger</span><span class="p">(</span><span class="n">Logger</span><span class="p">):</span>
    <span class="n">_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">InteractionKey</span><span class="p">,</span> <span class="n">InteractionData</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">scene</span><span class="p">:</span> <span class="n">ScatteringScene</span><span class="p">,</span>
        <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">keep3D</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">views</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ViewGroup</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">View2D</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ViewGroup</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span>
        <span class="n">defaultViewEnergyType</span><span class="p">:</span> <span class="n">EnergyType</span> <span class="o">=</span> <span class="n">EnergyType</span><span class="o">.</span><span class="n">DEPOSITION</span><span class="p">,</span>
        <span class="n">defaultBinSize</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
        <span class="n">infiniteLimits</span><span class="o">=</span><span class="p">((</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log the energy deposited by scattering photons as well as the energy that crossed surfaces. Every interaction</span>
<span class="sd">        is linked to a specific solid and surface of the scene when applicable. This `EnergyLogger` has to be given to</span>
<span class="sd">        a `Source` instance when propagating.</span>

<span class="sd">        :param scene: The scene is required to auto-initialize the 2D views correctly. Even if `keep3D` is True, the</span>
<span class="sd">                scene may be used later to correctly create and display the 2D views.</span>
<span class="sd">        :param filepath: (Optional) Load the logger from the given file. When saving, the file will be overwritten.</span>
<span class="sd">        :param keep3D: (Default to True) If False, logged datapoints are automatically binned to predefined 2D `views`</span>
<span class="sd">                and the 3D data is discarded. This allows for a lightweight logger alternative. If True, the 3D data is</span>
<span class="sd">                kept and the 2D views are only computed later if displayed.</span>
<span class="sd">        :param views: The 2D views to track, particularly used when `keep3D` is set to False. Can be a ViewGroup flag</span>
<span class="sd">                or a list of View2D. Default to ViewGroup.ALL which includes the 3 default XYZ projections for the</span>
<span class="sd">                whole scene as well as for each solid, and a projection of each surface in the direction of the surface</span>
<span class="sd">                normal for both the energy entering and leaving the surface. When `keep3D` is False, ViewGroup.All is</span>
<span class="sd">                required to allow calculation of the detailed report for absorbance and transmittance. When `keep3D` is</span>
<span class="sd">                True, the 2D views data is only computed when displayed, so it is equivalent to setting `views` to None.</span>
<span class="sd">        :param defaultBinSize: The default bin size to use when binning the 3D data to 2D views. In the same physical</span>
<span class="sd">                units as the scene. Custom bin sizes can be specified in each View2D.</span>
<span class="sd">        :param infiniteLimits: The default limits to use for the 2D views when the scene is infinite (has no solids).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span> <span class="o">=</span> <span class="n">scene</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keep3D</span> <span class="o">=</span> <span class="n">keep3D</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defaultBinSize</span> <span class="o">=</span> <span class="n">defaultBinSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_infiniteLimits</span> <span class="o">=</span> <span class="n">infiniteLimits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_viewFactory</span> <span class="o">=</span> <span class="n">ViewFactory</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">defaultBinSize</span><span class="p">,</span> <span class="n">infiniteLimits</span><span class="p">,</span> <span class="n">energyType</span><span class="o">=</span><span class="n">defaultViewEnergyType</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sceneHash</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defaultViews</span> <span class="o">=</span> <span class="n">views</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_views</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_viewFactory</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">views</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outdatedViews</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nDataPointsRemoved</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fromFilepath</span><span class="o">=</span><span class="n">filepath</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">addView</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">View2D</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_viewFactory</span><span class="o">.</span><span class="n">build</span><span class="p">([</span><span class="n">view</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_viewExists</span><span class="p">(</span><span class="n">view</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has3D</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_compileViews</span><span class="p">([</span><span class="n">view</span><span class="p">],</span> <span class="n">detectedBy</span><span class="o">=</span><span class="n">view</span><span class="o">.</span><span class="n">detectedBy</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">existingView</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">view</span><span class="o">.</span><span class="n">isContainedBy</span><span class="p">(</span><span class="n">existingView</span><span class="p">):</span>
                <span class="n">view</span><span class="o">.</span><span class="n">initDataFrom</span><span class="p">(</span><span class="n">existingView</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">existingView</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outdatedViews</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_outdatedViews</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="n">utils</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;ERROR: Cannot create view </span><span class="si">{</span><span class="n">view</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">. The 3D data was discarded and the required data was not &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;found in existing views.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">updateView</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">View2D</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">view</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outdatedViews</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_compileViews</span><span class="p">([</span><span class="n">view</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">showView</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">View2D</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">viewIndex</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">logScale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">colormap</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;viridis&quot;</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">viewIndex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">view</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Either `viewIndex` or `view` must be specified.&quot;</span>

        <span class="k">if</span> <span class="n">viewIndex</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addView</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">created</span><span class="p">:</span>
                <span class="n">utils</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: Cannot display view </span><span class="si">{</span><span class="n">view</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">. Failed to create the view.&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">viewIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getViewIndex</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>

        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">viewIndex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateView</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>

        <span class="n">view</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">logScale</span><span class="o">=</span><span class="n">logScale</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="n">colormap</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">listViews</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Available views:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">view</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">view</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filepath</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_LOGGER_PATH</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No filepath specified. Saving to </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">filepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filepath</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_labels</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_defaultViews</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_outdatedViews</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_nDataPointsRemoved</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_sceneHash</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">has3D</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">file</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filepath</span> <span class="o">=</span> <span class="n">filepath</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;No logger file found at &#39;</span><span class="si">{}</span><span class="s2">&#39;. No data loaded, but it will create a new file &quot;</span>
                <span class="s2">&quot;at this location if the logger is saved later on.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_labels</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">,</span>
                <span class="n">oldDefaultViews</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_outdatedViews</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_nDataPointsRemoved</span><span class="p">,</span>
                <span class="n">oldSceneHash</span><span class="p">,</span>
                <span class="n">oldHas3D</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">oldSceneHash</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sceneHash</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;WARNING: The scene used to create the logger at &#39;</span><span class="si">{}</span><span class="s2">&#39; is different from the current &quot;</span>
                <span class="s2">&quot;scene. This may corrupt statistics and visualization. Proceed at your own risk.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">oldHas3D</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep3D</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;WARNING: The logger at &#39;</span><span class="si">{}</span><span class="s2">&#39; use to store 3D data, but it was reloaded with keep3D=False. &quot;</span>
                <span class="s2">&quot;The 3D data will be compiled to 2D views and discarded.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">oldHas3D</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep3D</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;WARNING: The logger at &#39;</span><span class="si">{}</span><span class="s2">&#39; use to discard 3D data, but it was reloaded with keep3D=True. &quot;</span>
                <span class="s2">&quot;This may corrupt the statistics and the 3D visualization. Proceed at your own risk.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaultViews</span> <span class="o">!=</span> <span class="n">oldDefaultViews</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;WARNING: Cannot provide new default views to a loaded logger from &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span>
                <span class="s2">&quot;Using only the views from the file.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">views</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">View2D</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_views</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getView</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">View2D</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;View index </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> is out of range [0, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">)</span><span class="si">}</span><span class="s2">]. Use `.listViews()` to see &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;available views.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_getViewIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">View2D</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">isEqualTo</span><span class="p">(</span><span class="n">view</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">i</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;View </span><span class="si">{</span><span class="n">view</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> not found in the list of views.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_viewExists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">View2D</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">([</span><span class="n">view</span><span class="o">.</span><span class="n">isEqualTo</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">has3D</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep3D</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">defaultBinSize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaultBinSize</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">infiniteLimits</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infiniteLimits</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getSolidLimits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">getSolid</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)</span><span class="o">.</span><span class="n">getBoundingBox</span><span class="p">()</span><span class="o">.</span><span class="n">xyzLimits</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">logDataPointArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">InteractionKey</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used internally by `Source` when propagating photons. Overwrites the `Logger` method to automatically bin the</span>
<span class="sd">        data to 2D views if 3D data is being discarded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">logDataPointArray</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outdatedViews</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep3D</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_compileViews</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_delete3DData</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">logDataPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">InteractionKey</span><span class="p">,</span> <span class="n">ID</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">dataPoint</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">position</span><span class="o">.</span><span class="n">array</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ID</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dataPoint</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logDataPointArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dataPoint</span><span class="p">]),</span> <span class="n">key</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_compileViews</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">views</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">View2D</span><span class="p">],</span> <span class="n">detectedBy</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">detectedBy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dataPerInteraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">detectedBy</span> <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="n">views</span><span class="p">):</span>
                <span class="n">utils</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Ignoring the detectedBy property of a view. Can only use detectedBy when adding a view after the &quot;</span>
                    <span class="s2">&quot;simulation with keep3D=True.&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dataPerInteraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFiltered</span><span class="p">(</span><span class="n">detectedBy</span><span class="p">)</span><span class="o">.</span><span class="n">_data</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">dataPerInteraction</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">datapointsContainer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ListArrayContainer</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dataPoints</span>
            <span class="k">if</span> <span class="n">datapointsContainer</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">datapointsContainer</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="n">views</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">view</span><span class="o">.</span><span class="n">solidLabel</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">utils</span><span class="o">.</span><span class="n">labelsEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">solidLabel</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">solidLabel</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">view</span><span class="o">.</span><span class="n">surfaceLabel</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">utils</span><span class="o">.</span><span class="n">labelsEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">surfaceLabel</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">surfaceLabel</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">view</span><span class="o">.</span><span class="n">surfaceLabel</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">key</span><span class="o">.</span><span class="n">surfaceLabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">data</span> <span class="o">=</span> <span class="n">datapointsContainer</span><span class="o">.</span><span class="n">getData</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">view</span><span class="o">.</span><span class="n">energyType</span> <span class="o">==</span> <span class="n">EnergyType</span><span class="o">.</span><span class="n">FLUENCE_RATE</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fluenceTransform</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

                <span class="n">view</span><span class="o">.</span><span class="n">extractData</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="n">views</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outdatedViews</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_delete3DData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nDataPointsRemoved</span> <span class="o">+=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">nDataPoints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">nDataPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Overwrites the `Logger` method to return the total number of data points logged, including the ones discarded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep3D</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">nDataPoints</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nDataPointsRemoved</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">isEmpty</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nDataPoints</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">logPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">InteractionKey</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Can only log data points to an EnergyLogger.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">logPointArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">InteractionKey</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Can only log data points to an EnergyLogger.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">logSegment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="n">Vector</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">InteractionKey</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Can only log data points to an EnergyLogger.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">logSegmentArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">InteractionKey</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Can only log data points to an EnergyLogger.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getDataPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">InteractionKey</span><span class="p">,</span> <span class="n">energyType</span><span class="o">=</span><span class="n">EnergyType</span><span class="o">.</span><span class="n">DEPOSITION</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;All 3D data points recorded for this InteractionKey (not binned). Array of shape (n, 4) where</span>
<span class="sd">        the second axis is (value, x, y, z). The value can be the energy deposited, the fluence rate, or the</span>
<span class="sd">        energy that crossed the surface.</span>

<span class="sd">        :param key: Filtering the data by solidLabel and surfaceLabel.</span>
<span class="sd">        :param energyType: The type of volumetric energy to return when no surfaceLabel is given.</span>

<span class="sd">        :return: The data points (value, x, y, z) for the given solidLabel and surfaceLabel. If a surfaceLabel is given,</span>
<span class="sd">        the value corresponds to the energy that crossed the surface (positive when in the direction of the normal). If</span>
<span class="sd">        only a solidLabel is given, the value corresponds to the volumetric EnergyType at that point.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">energyType</span> <span class="o">==</span> <span class="n">EnergyType</span><span class="o">.</span><span class="n">FLUENCE_RATE</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getData</span><span class="p">(</span><span class="n">DataType</span><span class="o">.</span><span class="n">DATA_POINT</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fluenceTransform</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getData</span><span class="p">(</span><span class="n">DataType</span><span class="o">.</span><span class="n">DATA_POINT</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detectedBy</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Keeps only the data points from photons detected by one of the specified detector(s).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep3D</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Cannot filter a logger that has discarded the 3D data.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">filteredPhotonIDs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getDetectedPhotonIDs</span><span class="p">(</span><span class="n">detectedBy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getDataForPhotons</span><span class="p">(</span><span class="n">filteredPhotonIDs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outdatedViews</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getFiltered</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detectedBy</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="s2">&quot;EnergyLogger&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a new logger with only data from photons detected by one of the specified detector(s).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filteredLogger</span> <span class="o">=</span> <span class="n">EnergyLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="p">,</span> <span class="n">views</span><span class="o">=</span><span class="p">[])</span>
        <span class="n">filteredPhotonIDs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getDetectedPhotonIDs</span><span class="p">(</span><span class="n">detectedBy</span><span class="p">)</span>
        <span class="n">filteredLogger</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getDataForPhotons</span><span class="p">(</span><span class="n">filteredPhotonIDs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">filteredLogger</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_getDetectedPhotonIDs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detectedBy</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper to get photon IDs detected by one of the specified detector(s).&quot;&quot;&quot;</span>
        <span class="n">detector_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">detectedBy</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">detectedBy</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">detectedBy</span>
        <span class="n">detector_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">InteractionKey</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">detector_labels</span><span class="p">]</span>
        <span class="n">photonIDs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getPhotonIDs</span><span class="p">(</span><span class="n">detector_keys</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">photonIDs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No photons detected by: </span><span class="si">{</span><span class="n">detectedBy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">photonIDs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_getPhotonIDs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">InteractionKey</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">InteractionKey</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all unique photon IDs that interacted with one of the given interaction key(s).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">all_photon_ids</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRawDataPoints</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">all_photon_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_photon_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
            <span class="n">combined</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_photon_ids</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">combined</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRawDataPoints</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_getDataForPhotons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">photonIDs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">InteractionKey</span><span class="p">,</span> <span class="n">InteractionData</span><span class="p">]:</span>
        <span class="n">keyToData</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">InteractionKey</span><span class="p">,</span> <span class="n">InteractionData</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">photonIDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">photonIDs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">interactionData</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">points</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ListArrayContainer</span><span class="p">]</span> <span class="o">=</span> <span class="n">interactionData</span><span class="o">.</span><span class="n">dataPoints</span>
            <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">getData</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">),</span> <span class="n">photonIDs</span><span class="p">)</span>
            <span class="n">filteredData</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">filteredData</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">container</span> <span class="o">=</span> <span class="n">ListArrayContainer</span><span class="p">()</span>
                <span class="n">container</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filteredData</span><span class="p">)</span>
                <span class="n">keyToData</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">InteractionData</span><span class="p">(</span><span class="n">dataPoints</span><span class="o">=</span><span class="n">container</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">keyToData</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_fluenceTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">InteractionKey</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
        <span class="c1"># Converts volumetric data to fluence rate when needed.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">volumetric</span> <span class="ow">or</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span>

        <span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">getMaterial</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">solidLabel</span><span class="p">)</span><span class="o">.</span><span class="n">mu_a</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exportName</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export the raw 3D data points to a CSV file, along with the scene information to a JSON file.</span>

<span class="sd">        The data file &lt;exportName&gt;.csv will be comma-delimited and will contain the following columns:</span>
<span class="sd">        - energy, x, y, z, photon_index, solid_index, surface_index</span>

<span class="sd">        Two types of interactions are logged: scattering and surface crossings. In the first case, the energy will be</span>
<span class="sd">        the delta energy deposited at the point and the surface index will be -1. In the second case, the energy</span>
<span class="sd">        will be the total photon energy when crossing the surface, either as positive if leaving the surface</span>
<span class="sd">        (along the normal) or as negative if entering the surface.</span>

<span class="sd">        The scene information will be saved in a JSON file named &lt;exportName&gt;.json, which includes details for each solid</span>
<span class="sd">        index and surface index, such as their labels, materials, and geometry. The world information is also exported</span>
<span class="sd">        as solid index -1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has3D</span><span class="p">:</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Cannot export data when keep3D is False. No 3D data available.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">solidLabels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">solid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">solids</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">solid</span><span class="o">.</span><span class="n">isStack</span><span class="p">():</span>
                <span class="n">solidLabels</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">solid</span><span class="o">.</span><span class="n">getLayerLabels</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">solidLabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solid</span><span class="o">.</span><span class="n">getLabel</span><span class="p">())</span>
        <span class="n">solidLabels</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exporting raw data to file...&quot;</span><span class="p">)</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exportName</span><span class="si">}</span><span class="s2">.csv&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;energy,x,y,z,photon_index,solid_index,surface_index</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_writeKeyData</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">InteractionKey</span><span class="p">(</span><span class="n">WORLD_SOLID_LABEL</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">solidLabel</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">solidLabels</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_writeKeyData</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">InteractionKey</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">surfaceLabel</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">getSurfaceLabels</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_writeKeyData</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">InteractionKey</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">,</span> <span class="n">surfaceLabel</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exported data points to </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_exportSceneInfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exportName</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">,</span> <span class="n">solidLabels</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_writeKeyData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">TextIO</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">InteractionKey</span><span class="p">,</span> <span class="n">solidIndex</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">surfaceIndex</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">dataPoints</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">dataArray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">dataPoints</span><span class="o">.</span><span class="n">getData</span><span class="p">()</span>
        <span class="n">n_rows</span> <span class="o">=</span> <span class="n">dataArray</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">output</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataArray</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">output</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataArray</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
        <span class="n">output</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">solidIndex</span>
        <span class="n">output</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">surfaceIndex</span>

        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span>
            <span class="n">file</span><span class="p">,</span>
            <span class="n">output</span><span class="p">,</span>
            <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span>
            <span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">%.8e</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%.8e</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%.8e</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%.8e</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_exportSceneInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">solidLabels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="n">sceneInfo</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">material</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">getWorldEnvironment</span><span class="p">()</span><span class="o">.</span><span class="n">material</span>
        <span class="n">sceneInfo</span><span class="p">[</span><span class="s2">&quot;-1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;world&quot;</span><span class="p">,</span> <span class="s2">&quot;material&quot;</span><span class="p">:</span> <span class="n">material</span><span class="o">.</span><span class="vm">__dict__</span> <span class="k">if</span> <span class="n">material</span> <span class="k">else</span> <span class="kc">None</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">solidLabel</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">solidLabels</span><span class="p">):</span>
            <span class="n">material</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">getMaterial</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)</span>
            <span class="n">solid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">getSolid</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)</span>
            <span class="n">surfaces</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">surfaceLabel</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">solid</span><span class="o">.</span><span class="n">surfaceLabels</span><span class="p">):</span>
                <span class="n">normals</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">normal</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">solid</span><span class="o">.</span><span class="n">getPolygons</span><span class="p">(</span><span class="n">surfaceLabel</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">normals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">normals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">normals</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">normal</span> <span class="o">=</span> <span class="n">normals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">array</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">normal</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">surfaces</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">surfaceLabel</span><span class="p">,</span> <span class="s2">&quot;normal&quot;</span><span class="p">:</span> <span class="n">normal</span><span class="p">}</span>

            <span class="n">sceneInfo</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">solidLabel</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">solid</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="s2">&quot;material&quot;</span><span class="p">:</span> <span class="n">material</span><span class="o">.</span><span class="vm">__dict__</span> <span class="k">if</span> <span class="n">material</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">solid</span><span class="o">.</span><span class="n">geometryExport</span><span class="p">(),</span>
                <span class="s2">&quot;surfaces&quot;</span><span class="p">:</span> <span class="n">surfaces</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">sceneInfo</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exported scene information to </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="pytissueoptics.rayscattering.EnergyLogger.nDataPoints" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">nDataPoints</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Overwrites the <code>Logger</code> method to return the total number of data points logged, including the ones discarded.</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="pytissueoptics.rayscattering.EnergyLogger.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep3D</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">views</span><span class="o">=</span><span class="n">ViewGroup</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="n">defaultViewEnergyType</span><span class="o">=</span><span class="n">EnergyType</span><span class="o">.</span><span class="n">DEPOSITION</span><span class="p">,</span> <span class="n">defaultBinSize</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">infiniteLimits</span><span class="o">=</span><span class="p">((</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Log the energy deposited by scattering photons as well as the energy that crossed surfaces. Every interaction
is linked to a specific solid and surface of the scene when applicable. This <code>EnergyLogger</code> has to be given to
a <code>Source</code> instance when propagating.</p>
<p>:param scene: The scene is required to auto-initialize the 2D views correctly. Even if <code>keep3D</code> is True, the
        scene may be used later to correctly create and display the 2D views.
:param filepath: (Optional) Load the logger from the given file. When saving, the file will be overwritten.
:param keep3D: (Default to True) If False, logged datapoints are automatically binned to predefined 2D <code>views</code>
        and the 3D data is discarded. This allows for a lightweight logger alternative. If True, the 3D data is
        kept and the 2D views are only computed later if displayed.
:param views: The 2D views to track, particularly used when <code>keep3D</code> is set to False. Can be a ViewGroup flag
        or a list of View2D. Default to ViewGroup.ALL which includes the 3 default XYZ projections for the
        whole scene as well as for each solid, and a projection of each surface in the direction of the surface
        normal for both the energy entering and leaving the surface. When <code>keep3D</code> is False, ViewGroup.All is
        required to allow calculation of the detailed report for absorbance and transmittance. When <code>keep3D</code> is
        True, the 2D views data is only computed when displayed, so it is equivalent to setting <code>views</code> to None.
:param defaultBinSize: The default bin size to use when binning the 3D data to 2D views. In the same physical
        units as the scene. Custom bin sizes can be specified in each View2D.
:param infiniteLimits: The default limits to use for the 2D views when the scene is infinite (has no solids).</p>


            <details class="quote">
              <summary>Source code in <code>pytissueoptics/rayscattering/energyLogging/energyLogger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">scene</span><span class="p">:</span> <span class="n">ScatteringScene</span><span class="p">,</span>
    <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">keep3D</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">views</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ViewGroup</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">View2D</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ViewGroup</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span>
    <span class="n">defaultViewEnergyType</span><span class="p">:</span> <span class="n">EnergyType</span> <span class="o">=</span> <span class="n">EnergyType</span><span class="o">.</span><span class="n">DEPOSITION</span><span class="p">,</span>
    <span class="n">defaultBinSize</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">infiniteLimits</span><span class="o">=</span><span class="p">((</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Log the energy deposited by scattering photons as well as the energy that crossed surfaces. Every interaction</span>
<span class="sd">    is linked to a specific solid and surface of the scene when applicable. This `EnergyLogger` has to be given to</span>
<span class="sd">    a `Source` instance when propagating.</span>

<span class="sd">    :param scene: The scene is required to auto-initialize the 2D views correctly. Even if `keep3D` is True, the</span>
<span class="sd">            scene may be used later to correctly create and display the 2D views.</span>
<span class="sd">    :param filepath: (Optional) Load the logger from the given file. When saving, the file will be overwritten.</span>
<span class="sd">    :param keep3D: (Default to True) If False, logged datapoints are automatically binned to predefined 2D `views`</span>
<span class="sd">            and the 3D data is discarded. This allows for a lightweight logger alternative. If True, the 3D data is</span>
<span class="sd">            kept and the 2D views are only computed later if displayed.</span>
<span class="sd">    :param views: The 2D views to track, particularly used when `keep3D` is set to False. Can be a ViewGroup flag</span>
<span class="sd">            or a list of View2D. Default to ViewGroup.ALL which includes the 3 default XYZ projections for the</span>
<span class="sd">            whole scene as well as for each solid, and a projection of each surface in the direction of the surface</span>
<span class="sd">            normal for both the energy entering and leaving the surface. When `keep3D` is False, ViewGroup.All is</span>
<span class="sd">            required to allow calculation of the detailed report for absorbance and transmittance. When `keep3D` is</span>
<span class="sd">            True, the 2D views data is only computed when displayed, so it is equivalent to setting `views` to None.</span>
<span class="sd">    :param defaultBinSize: The default bin size to use when binning the 3D data to 2D views. In the same physical</span>
<span class="sd">            units as the scene. Custom bin sizes can be specified in each View2D.</span>
<span class="sd">    :param infiniteLimits: The default limits to use for the 2D views when the scene is infinite (has no solids).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span> <span class="o">=</span> <span class="n">scene</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_keep3D</span> <span class="o">=</span> <span class="n">keep3D</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_defaultBinSize</span> <span class="o">=</span> <span class="n">defaultBinSize</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_infiniteLimits</span> <span class="o">=</span> <span class="n">infiniteLimits</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_viewFactory</span> <span class="o">=</span> <span class="n">ViewFactory</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">defaultBinSize</span><span class="p">,</span> <span class="n">infiniteLimits</span><span class="p">,</span> <span class="n">energyType</span><span class="o">=</span><span class="n">defaultViewEnergyType</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_sceneHash</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_defaultViews</span> <span class="o">=</span> <span class="n">views</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_views</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_viewFactory</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">views</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_outdatedViews</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_nDataPointsRemoved</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">fromFilepath</span><span class="o">=</span><span class="n">filepath</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pytissueoptics.rayscattering.EnergyLogger.export" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">export</span><span class="p">(</span><span class="n">exportName</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Export the raw 3D data points to a CSV file, along with the scene information to a JSON file.</p>
<p>The data file <exportName>.csv will be comma-delimited and will contain the following columns:
- energy, x, y, z, photon_index, solid_index, surface_index</p>
<p>Two types of interactions are logged: scattering and surface crossings. In the first case, the energy will be
the delta energy deposited at the point and the surface index will be -1. In the second case, the energy
will be the total photon energy when crossing the surface, either as positive if leaving the surface
(along the normal) or as negative if entering the surface.</p>
<p>The scene information will be saved in a JSON file named <exportName>.json, which includes details for each solid
index and surface index, such as their labels, materials, and geometry. The world information is also exported
as solid index -1.</p>


            <details class="quote">
              <summary>Source code in <code>pytissueoptics/rayscattering/energyLogging/energyLogger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exportName</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Export the raw 3D data points to a CSV file, along with the scene information to a JSON file.</span>

<span class="sd">    The data file &lt;exportName&gt;.csv will be comma-delimited and will contain the following columns:</span>
<span class="sd">    - energy, x, y, z, photon_index, solid_index, surface_index</span>

<span class="sd">    Two types of interactions are logged: scattering and surface crossings. In the first case, the energy will be</span>
<span class="sd">    the delta energy deposited at the point and the surface index will be -1. In the second case, the energy</span>
<span class="sd">    will be the total photon energy when crossing the surface, either as positive if leaving the surface</span>
<span class="sd">    (along the normal) or as negative if entering the surface.</span>

<span class="sd">    The scene information will be saved in a JSON file named &lt;exportName&gt;.json, which includes details for each solid</span>
<span class="sd">    index and surface index, such as their labels, materials, and geometry. The world information is also exported</span>
<span class="sd">    as solid index -1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has3D</span><span class="p">:</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Cannot export data when keep3D is False. No 3D data available.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">solidLabels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">solid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">solids</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">solid</span><span class="o">.</span><span class="n">isStack</span><span class="p">():</span>
            <span class="n">solidLabels</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">solid</span><span class="o">.</span><span class="n">getLayerLabels</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">solidLabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solid</span><span class="o">.</span><span class="n">getLabel</span><span class="p">())</span>
    <span class="n">solidLabels</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exporting raw data to file...&quot;</span><span class="p">)</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exportName</span><span class="si">}</span><span class="s2">.csv&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;energy,x,y,z,photon_index,solid_index,surface_index</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_writeKeyData</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">InteractionKey</span><span class="p">(</span><span class="n">WORLD_SOLID_LABEL</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">solidLabel</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">solidLabels</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_writeKeyData</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">InteractionKey</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">surfaceLabel</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">getSurfaceLabels</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_writeKeyData</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">InteractionKey</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">,</span> <span class="n">surfaceLabel</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exported data points to </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_exportSceneInfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exportName</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">,</span> <span class="n">solidLabels</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pytissueoptics.rayscattering.EnergyLogger.filter" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">filter</span><span class="p">(</span><span class="n">detectedBy</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Keeps only the data points from photons detected by one of the specified detector(s).</p>


            <details class="quote">
              <summary>Source code in <code>pytissueoptics/rayscattering/energyLogging/energyLogger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detectedBy</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Keeps only the data points from photons detected by one of the specified detector(s).&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep3D</span><span class="p">:</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Cannot filter a logger that has discarded the 3D data.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">filteredPhotonIDs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getDetectedPhotonIDs</span><span class="p">(</span><span class="n">detectedBy</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getDataForPhotons</span><span class="p">(</span><span class="n">filteredPhotonIDs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_outdatedViews</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pytissueoptics.rayscattering.EnergyLogger.getDataPoints" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getDataPoints</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">energyType</span><span class="o">=</span><span class="n">EnergyType</span><span class="o">.</span><span class="n">DEPOSITION</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>All 3D data points recorded for this InteractionKey (not binned). Array of shape (n, 4) where
the second axis is (value, x, y, z). The value can be the energy deposited, the fluence rate, or the
energy that crossed the surface.</p>
<p>:param key: Filtering the data by solidLabel and surfaceLabel.
:param energyType: The type of volumetric energy to return when no surfaceLabel is given.</p>
<p>:return: The data points (value, x, y, z) for the given solidLabel and surfaceLabel. If a surfaceLabel is given,
the value corresponds to the energy that crossed the surface (positive when in the direction of the normal). If
only a solidLabel is given, the value corresponds to the volumetric EnergyType at that point.</p>


            <details class="quote">
              <summary>Source code in <code>pytissueoptics/rayscattering/energyLogging/energyLogger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getDataPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">InteractionKey</span><span class="p">,</span> <span class="n">energyType</span><span class="o">=</span><span class="n">EnergyType</span><span class="o">.</span><span class="n">DEPOSITION</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;All 3D data points recorded for this InteractionKey (not binned). Array of shape (n, 4) where</span>
<span class="sd">    the second axis is (value, x, y, z). The value can be the energy deposited, the fluence rate, or the</span>
<span class="sd">    energy that crossed the surface.</span>

<span class="sd">    :param key: Filtering the data by solidLabel and surfaceLabel.</span>
<span class="sd">    :param energyType: The type of volumetric energy to return when no surfaceLabel is given.</span>

<span class="sd">    :return: The data points (value, x, y, z) for the given solidLabel and surfaceLabel. If a surfaceLabel is given,</span>
<span class="sd">    the value corresponds to the energy that crossed the surface (positive when in the direction of the normal). If</span>
<span class="sd">    only a solidLabel is given, the value corresponds to the volumetric EnergyType at that point.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">energyType</span> <span class="o">==</span> <span class="n">EnergyType</span><span class="o">.</span><span class="n">FLUENCE_RATE</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getData</span><span class="p">(</span><span class="n">DataType</span><span class="o">.</span><span class="n">DATA_POINT</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fluenceTransform</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getData</span><span class="p">(</span><span class="n">DataType</span><span class="o">.</span><span class="n">DATA_POINT</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pytissueoptics.rayscattering.EnergyLogger.getFiltered" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getFiltered</span><span class="p">(</span><span class="n">detectedBy</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns a new logger with only data from photons detected by one of the specified detector(s).</p>


            <details class="quote">
              <summary>Source code in <code>pytissueoptics/rayscattering/energyLogging/energyLogger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getFiltered</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detectedBy</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="s2">&quot;EnergyLogger&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a new logger with only data from photons detected by one of the specified detector(s).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filteredLogger</span> <span class="o">=</span> <span class="n">EnergyLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="p">,</span> <span class="n">views</span><span class="o">=</span><span class="p">[])</span>
    <span class="n">filteredPhotonIDs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getDetectedPhotonIDs</span><span class="p">(</span><span class="n">detectedBy</span><span class="p">)</span>
    <span class="n">filteredLogger</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getDataForPhotons</span><span class="p">(</span><span class="n">filteredPhotonIDs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">filteredLogger</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pytissueoptics.rayscattering.EnergyLogger.logDataPointArray" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logDataPointArray</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Used internally by <code>Source</code> when propagating photons. Overwrites the <code>Logger</code> method to automatically bin the
data to 2D views if 3D data is being discarded.</p>


            <details class="quote">
              <summary>Source code in <code>pytissueoptics/rayscattering/energyLogging/energyLogger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">logDataPointArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">InteractionKey</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used internally by `Source` when propagating photons. Overwrites the `Logger` method to automatically bin the</span>
<span class="sd">    data to 2D views if 3D data is being discarded.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">logDataPointArray</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_outdatedViews</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep3D</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compileViews</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete3DData</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pytissueoptics.rayscattering.EnergyType" class="doc doc-heading">
            <code>EnergyType</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Enum">Enum</span></code></p>


        <p>Type of volumetric energy: either as the deposited energy in the solid (absorption) or as the fluence rate.</p>








              <details class="quote">
                <summary>Source code in <code>pytissueoptics/rayscattering/energyLogging/energyType.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EnergyType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Type of volumetric energy: either as the deposited energy in the solid (absorption) or as the fluence rate.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DEPOSITION</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">FLUENCE_RATE</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pytissueoptics.rayscattering.PointCloudStyle" class="doc doc-heading">
            <code>PointCloudStyle</code>


</h2>


    <div class="doc doc-contents ">


        <p>3D display configuration for solid and surface point clouds.</p>


<details class="visibility-attributes" open>
  <summary>Visibility attributes</summary>
  <p>solidLabel (Optional[str]): Only show the point cloud specific to a single solid.
surfaceLabel (Optional[str]): Only show the point cloud specific to a single surface of the solid.
showSolidPoints (bool): Show the point clouds of the solids.
showSurfacePointsLeaving (bool): Show energy that left the surface (direction with surface normal).
showSurfacePointsEntering (bool): Show energy that entered the surface (direction opposite to surface normal).
energyType (EnergyType): Type of energy to show for volumetric datapoints (deposition or fluence).</p>
</details>

<details class="other-attributes" open>
  <summary>Other attributes</summary>
  <p>showPointsAsSpheres (bool): Show the points as spheres or as dots. Dots require less memory.
pointSize (float): Reference diameter of the points in the point cloud when drawn as spheres.
scaleWithValue (bool): Scale the points with their value. A value of 1 yields the <code>pointSize</code>.
colormap (str): The name of the colormap to use for the point cloud.
reverseColormap (bool): Reverse the colormap.
surfacePointSize (float): Same as <code>pointSize</code>, but for the surface points.
surfaceScaleWithValue (bool): Same as <code>scaleWithValue</code> but for the surface points.
surfaceColormap (str): Same as <code>colormap</code> but for the surface points.
surfaceReverseColormap (bool): Same as <code>reverseColormap</code> but for the surface points.</p>
</details>







              <details class="quote">
                <summary>Source code in <code>pytissueoptics/rayscattering/display/viewer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PointCloudStyle</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    3D display configuration for solid and surface point clouds.</span>

<span class="sd">    Visibility attributes:</span>
<span class="sd">        solidLabel (Optional[str]): Only show the point cloud specific to a single solid.</span>
<span class="sd">        surfaceLabel (Optional[str]): Only show the point cloud specific to a single surface of the solid.</span>
<span class="sd">        showSolidPoints (bool): Show the point clouds of the solids.</span>
<span class="sd">        showSurfacePointsLeaving (bool): Show energy that left the surface (direction with surface normal).</span>
<span class="sd">        showSurfacePointsEntering (bool): Show energy that entered the surface (direction opposite to surface normal).</span>
<span class="sd">        energyType (EnergyType): Type of energy to show for volumetric datapoints (deposition or fluence).</span>

<span class="sd">    Other attributes:</span>
<span class="sd">        showPointsAsSpheres (bool): Show the points as spheres or as dots. Dots require less memory.</span>
<span class="sd">        pointSize (float): Reference diameter of the points in the point cloud when drawn as spheres.</span>
<span class="sd">        scaleWithValue (bool): Scale the points with their value. A value of 1 yields the `pointSize`.</span>
<span class="sd">        colormap (str): The name of the colormap to use for the point cloud.</span>
<span class="sd">        reverseColormap (bool): Reverse the colormap.</span>
<span class="sd">        surfacePointSize (float): Same as `pointSize`, but for the surface points.</span>
<span class="sd">        surfaceScaleWithValue (bool): Same as `scaleWithValue` but for the surface points.</span>
<span class="sd">        surfaceColormap (str): Same as `colormap` but for the surface points.</span>
<span class="sd">        surfaceReverseColormap (bool): Same as `reverseColormap` but for the surface points.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">solidLabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">surfaceLabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">showSolidPoints</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">showSurfacePointsLeaving</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">showSurfacePointsEntering</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">energyType</span><span class="o">=</span><span class="n">EnergyType</span><span class="o">.</span><span class="n">DEPOSITION</span><span class="p">,</span>
        <span class="n">detectedBy</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">showPointsAsSpheres</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">pointSize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">,</span>
        <span class="n">scaleWithValue</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">colormap</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;rainbow&quot;</span><span class="p">,</span>
        <span class="n">reverseColormap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">surfacePointSize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
        <span class="n">surfaceScaleWithValue</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">surfaceColormap</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">surfaceReverseColormap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solidLabel</span> <span class="o">=</span> <span class="n">solidLabel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surfaceLabel</span> <span class="o">=</span> <span class="n">surfaceLabel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showSolidPoints</span> <span class="o">=</span> <span class="n">showSolidPoints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showSurfacePointsLeaving</span> <span class="o">=</span> <span class="n">showSurfacePointsLeaving</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showSurfacePointsEntering</span> <span class="o">=</span> <span class="n">showSurfacePointsEntering</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energyType</span> <span class="o">=</span> <span class="n">energyType</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detectedBy</span> <span class="o">=</span> <span class="n">detectedBy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showPointsAsSpheres</span> <span class="o">=</span> <span class="n">showPointsAsSpheres</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pointSize</span> <span class="o">=</span> <span class="n">pointSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaleWithValue</span> <span class="o">=</span> <span class="n">scaleWithValue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colormap</span> <span class="o">=</span> <span class="n">colormap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reverseColormap</span> <span class="o">=</span> <span class="n">reverseColormap</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">surfacePointSize</span> <span class="o">=</span> <span class="n">surfacePointSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surfaceScaleWithValue</span> <span class="o">=</span> <span class="n">surfaceScaleWithValue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surfaceColormap</span> <span class="o">=</span> <span class="n">colormap</span> <span class="k">if</span> <span class="n">surfaceColormap</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">surfaceColormap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surfaceReverseColormap</span> <span class="o">=</span> <span class="n">reverseColormap</span> <span class="k">if</span> <span class="n">surfaceReverseColormap</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">surfaceReverseColormap</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pytissueoptics.rayscattering.ScatteringScene" class="doc doc-heading">
            <code>ScatteringScene</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Scene (pytissueoptics.scene.Scene)" href="../scene/#pytissueoptics.scene.Scene">Scene</a></code></p>









              <details class="quote">
                <summary>Source code in <code>pytissueoptics/rayscattering/scatteringScene.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ScatteringScene</span><span class="p">(</span><span class="n">Scene</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Solid</span><span class="p">],</span> <span class="n">worldMaterial</span><span class="o">=</span><span class="n">ScatteringMaterial</span><span class="p">(),</span> <span class="n">ignoreIntersections</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">solids</span><span class="p">,</span> <span class="n">worldMaterial</span><span class="o">=</span><span class="n">worldMaterial</span><span class="p">,</span> <span class="n">ignoreIntersections</span><span class="o">=</span><span class="n">ignoreIntersections</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solid</span><span class="p">:</span> <span class="n">Solid</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="n">Vector</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">solid</span><span class="o">.</span><span class="n">isFlat</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">solid</span><span class="o">.</span><span class="n">isDetector</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Solid &#39;</span><span class="si">{</span><span class="n">solid</span><span class="o">.</span><span class="n">getLabel</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39; is flat. Flat solids must be used with asDetector().&quot;</span><span class="p">)</span>

        <span class="n">polygonSample</span> <span class="o">=</span> <span class="n">solid</span><span class="o">.</span><span class="n">getPolygons</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">polygonSample</span><span class="o">.</span><span class="n">insideEnvironment</span><span class="o">.</span><span class="n">material</span><span class="p">,</span> <span class="n">ScatteringMaterial</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">solid</span><span class="o">.</span><span class="n">isDetector</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Solid &#39;</span><span class="si">{</span><span class="n">solid</span><span class="o">.</span><span class="n">getLabel</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39; has no ScatteringMaterial defined. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;This is required for any RayScatteringScene. &quot;</span>
            <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">solid</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Displayable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s2">&quot;cool&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">viewer</span> <span class="o">=</span> <span class="n">get3DViewer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addToViewer</span><span class="p">(</span><span class="n">viewer</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">source</span><span class="p">:</span>
            <span class="n">source</span><span class="o">.</span><span class="n">addToViewer</span><span class="p">(</span><span class="n">viewer</span><span class="p">)</span>
        <span class="n">viewer</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getEstimatedIPP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weightThreshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the estimated number of interactions per photon. This gross estimation is done by assuming an infinite</span>
<span class="sd">        medium of mean scene albedo. Used as a starting point for the OpenCL kernel optimization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">materials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMaterials</span><span class="p">()</span>
        <span class="n">averageAlbedo</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">mat</span><span class="o">.</span><span class="n">getAlbedo</span><span class="p">()</span> <span class="k">for</span> <span class="n">mat</span> <span class="ow">in</span> <span class="n">materials</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">materials</span><span class="p">)</span>
        <span class="n">estimatedIPP</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">weightThreshold</span><span class="p">)</span> <span class="o">/</span> <span class="n">averageAlbedo</span>
        <span class="k">return</span> <span class="n">estimatedIPP</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pytissueoptics.rayscattering.ScatteringScene.getEstimatedIPP" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getEstimatedIPP</span><span class="p">(</span><span class="n">weightThreshold</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the estimated number of interactions per photon. This gross estimation is done by assuming an infinite
medium of mean scene albedo. Used as a starting point for the OpenCL kernel optimization.</p>


            <details class="quote">
              <summary>Source code in <code>pytissueoptics/rayscattering/scatteringScene.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getEstimatedIPP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weightThreshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the estimated number of interactions per photon. This gross estimation is done by assuming an infinite</span>
<span class="sd">    medium of mean scene albedo. Used as a starting point for the OpenCL kernel optimization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">materials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMaterials</span><span class="p">()</span>
    <span class="n">averageAlbedo</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">mat</span><span class="o">.</span><span class="n">getAlbedo</span><span class="p">()</span> <span class="k">for</span> <span class="n">mat</span> <span class="ow">in</span> <span class="n">materials</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">materials</span><span class="p">)</span>
    <span class="n">estimatedIPP</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">weightThreshold</span><span class="p">)</span> <span class="o">/</span> <span class="n">averageAlbedo</span>
    <span class="k">return</span> <span class="n">estimatedIPP</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pytissueoptics.rayscattering.Stats" class="doc doc-heading">
            <code>Stats</code>


</h2>


    <div class="doc doc-contents ">









              <details class="quote">
                <summary>Source code in <code>pytissueoptics/rayscattering/statistics/statistics.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Stats</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">EnergyLogger</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pointCloudFactory</span> <span class="o">=</span> <span class="n">PointCloudFactory</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extractFromViews</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">logger</span><span class="o">.</span><span class="n">has3D</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_photonCount</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;photonCount&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sourceSolidLabel</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;sourceSolidLabel&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_solidStatsMap</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">saveToFile</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">solidLabel</span> <span class="ow">and</span> <span class="n">solidLabel</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">getSeenSolidLabels</span><span class="p">():</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Cannot compute stats for solid &#39;</span><span class="si">{</span><span class="n">solidLabel</span><span class="si">}</span><span class="s2">&#39; because it was not logged.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_computeStats</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)</span>

        <span class="n">reportString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_makeReport</span><span class="p">(</span><span class="n">solidLabel</span><span class="o">=</span><span class="n">solidLabel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">saveToFile</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_saveReport</span><span class="p">(</span><span class="n">reportString</span><span class="p">,</span> <span class="n">saveToFile</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">reportString</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_computeStats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">solidLabels</span> <span class="o">=</span> <span class="p">[</span><span class="n">solidLabel</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">solidLabel</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">utils</span><span class="o">.</span><span class="n">labelsEqual</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">,</span> <span class="n">WORLD_SOLID_LABEL</span><span class="p">):</span>
            <span class="n">solidLabels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">getSeenSolidLabels</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">solidLabel</span> <span class="ow">in</span> <span class="n">solidLabels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">solidLabel</span> <span class="o">==</span> <span class="n">WORLD_SOLID_LABEL</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">absorbance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAbsorbance</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
                <span class="n">utils</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;WARNING: No energy input for solid &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">))</span>
                <span class="n">absorbance</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_solidStatsMap</span><span class="p">[</span><span class="n">solidLabel</span><span class="p">]</span> <span class="o">=</span> <span class="n">SolidStats</span><span class="p">(</span>
                <span class="n">absorbance</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getAbsorbance</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">,</span> <span class="n">useTotalEnergy</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getTransmittance</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_getSurfaceStats</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">),</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_makeReport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">reportString</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">solidLabel</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">solidLabel</span> <span class="o">==</span> <span class="n">WORLD_SOLID_LABEL</span><span class="p">:</span>
                <span class="n">reportString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reportWorld</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">reportString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reportSolid</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">solidLabel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">getSeenSolidLabels</span><span class="p">():</span>
                <span class="n">reportString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_makeReport</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">,</span> <span class="n">reportString</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reportString</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_reportWorld</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">worldLabel</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">totalSolidEnergy</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">solidStats</span><span class="o">.</span><span class="n">totalAbsorbance</span> <span class="k">for</span> <span class="n">solidStats</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_solidStatsMap</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
        <span class="n">reportString</span> <span class="o">=</span> <span class="s2">&quot;Report of &#39;</span><span class="si">{}</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">worldLabel</span><span class="p">)</span>
        <span class="n">reportString</span> <span class="o">+=</span> <span class="s2">&quot;  Absorbed </span><span class="si">{:.2f}% o</span><span class="s2">f total power</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">totalSolidEnergy</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reportString</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_reportSolid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">solidStats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_solidStatsMap</span><span class="p">[</span><span class="n">solidLabel</span><span class="p">]</span>
        <span class="n">reportString</span> <span class="o">=</span> <span class="s2">&quot;Report of solid &#39;</span><span class="si">{}</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">solidStats</span><span class="o">.</span><span class="n">absorbance</span> <span class="o">==</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
            <span class="c1"># Detectors don&#39;t log energy input.</span>
            <span class="n">reportString</span> <span class="o">+=</span> <span class="s2">&quot;  Detected </span><span class="si">{:.2f}% o</span><span class="s2">f total power</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">solidStats</span><span class="o">.</span><span class="n">totalAbsorbance</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">reportString</span>

        <span class="k">if</span> <span class="n">solidStats</span><span class="o">.</span><span class="n">absorbance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">reportString</span> <span class="o">+=</span> <span class="s2">&quot;  Absorbance: N/A (</span><span class="si">{:.2f}% o</span><span class="s2">f total power)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">solidStats</span><span class="o">.</span><span class="n">totalAbsorbance</span><span class="p">)</span>
            <span class="n">reportString</span> <span class="o">+=</span> <span class="s2">&quot;  Absorbance + Transmittance: N/A</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">return</span> <span class="n">reportString</span>

        <span class="n">reportString</span> <span class="o">+=</span> <span class="s2">&quot;  Absorbance: </span><span class="si">{:.2f}</span><span class="s2">% (</span><span class="si">{:.2f}% o</span><span class="s2">f total power)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">solidStats</span><span class="o">.</span><span class="n">absorbance</span><span class="p">,</span> <span class="n">solidStats</span><span class="o">.</span><span class="n">totalAbsorbance</span>
        <span class="p">)</span>
        <span class="n">reportString</span> <span class="o">+=</span> <span class="s2">&quot;  Absorbance + Transmittance: </span><span class="si">{:.1f}</span><span class="s2">%</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">solidStats</span><span class="o">.</span><span class="n">absorbance</span> <span class="o">+</span> <span class="n">solidStats</span><span class="o">.</span><span class="n">transmittance</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">surfaceLabel</span><span class="p">,</span> <span class="n">surfaceStats</span> <span class="ow">in</span> <span class="n">solidStats</span><span class="o">.</span><span class="n">surfaces</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">reportString</span> <span class="o">+=</span> <span class="s2">&quot;    Transmittance at &#39;</span><span class="si">{}</span><span class="s2">&#39;: </span><span class="si">{:.1f}</span><span class="s2">%</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">surfaceLabel</span><span class="p">,</span> <span class="n">surfaceStats</span><span class="o">.</span><span class="n">transmittance</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">reportString</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getAbsorbance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">useTotalEnergy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extractFromViews</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getAbsorbanceFromViews</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">,</span> <span class="n">useTotalEnergy</span><span class="p">)</span>
        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getPointCloud</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)</span><span class="o">.</span><span class="n">solidPoints</span>
        <span class="n">energyInput</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergyInput</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">useTotalEnergy</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPhotonCount</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">100</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sumEnergy</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">/</span> <span class="n">energyInput</span> <span class="k">if</span> <span class="n">energyInput</span> <span class="k">else</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_getAbsorbanceFromViews</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">useTotalEnergy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">energyInput</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergyInput</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">useTotalEnergy</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPhotonCount</span><span class="p">()</span>
        <span class="n">absorbedEnergy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getAbsorbedEnergyFromViews</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">absorbedEnergy</span> <span class="o">/</span> <span class="n">energyInput</span> <span class="k">if</span> <span class="n">energyInput</span> <span class="k">else</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_getAbsorbedEnergyFromViews</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">views</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">View2DProjection</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">utils</span><span class="o">.</span><span class="n">labelsEqual</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">,</span> <span class="n">view</span><span class="o">.</span><span class="n">solidLabel</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_viewContainsSolid</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">return</span> <span class="n">view</span><span class="o">.</span><span class="n">getSum</span><span class="p">()</span>

        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Could not extract absorbance for solid &#39;</span><span class="si">{</span><span class="n">solidLabel</span><span class="si">}</span><span class="s2">&#39;. The 3D data was discarded and &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;no stored 2D view corresponds to this solid.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_viewContainsSolid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">solidLimits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">getSolidLimits</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)</span>
        <span class="n">requiredLimitsU</span> <span class="o">=</span> <span class="n">solidLimits</span><span class="p">[</span><span class="n">view</span><span class="o">.</span><span class="n">axisU</span><span class="p">]</span>
        <span class="n">requiredLimitsV</span> <span class="o">=</span> <span class="n">solidLimits</span><span class="p">[</span><span class="n">view</span><span class="o">.</span><span class="n">axisV</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">limitsU</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">requiredLimitsU</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">max</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">limitsU</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">requiredLimitsU</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">limitsV</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">requiredLimitsV</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">max</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">limitsV</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">requiredLimitsV</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getPhotonCount</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_photonCount</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getEnergyInput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">solidLabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPhotonCount</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extractFromViews</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getEnergyInputFromViews</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)</span>
        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getPointCloudOfSurfaces</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)</span><span class="o">.</span><span class="n">enteringSurfacePoints</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sumEnergy</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">labelsEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sourceSolidLabel</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">):</span>
            <span class="n">energy</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPhotonCount</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">energy</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_getEnergyInputFromViews</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getEnergyCrossingSolidFromViews</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">,</span> <span class="n">leaving</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_getEnergyLeavingFromViews</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getEnergyCrossingSolidFromViews</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">,</span> <span class="n">leaving</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_getEnergyCrossingSolidFromViews</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">leaving</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">surfaceLabel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">getSeenSurfaceLabels</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">):</span>
            <span class="n">energy</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSurfaceEnergyFromViews</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">,</span> <span class="n">surfaceLabel</span><span class="p">,</span> <span class="n">leaving</span><span class="o">=</span><span class="n">leaving</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">labelsEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sourceSolidLabel</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">leaving</span><span class="p">:</span>
            <span class="n">energy</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPhotonCount</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">energy</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_getSurfaceEnergyFromViews</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">surfaceLabel</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">leaving</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">views</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">utils</span><span class="o">.</span><span class="n">labelsEqual</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">,</span> <span class="n">view</span><span class="o">.</span><span class="n">solidLabel</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">utils</span><span class="o">.</span><span class="n">labelsEqual</span><span class="p">(</span><span class="n">surfaceLabel</span><span class="p">,</span> <span class="n">view</span><span class="o">.</span><span class="n">surfaceLabel</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">view</span><span class="o">.</span><span class="n">surfaceEnergyLeaving</span> <span class="o">!=</span> <span class="n">leaving</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_viewContainsSolid</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">return</span> <span class="n">view</span><span class="o">.</span><span class="n">getSum</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Could not extract energy </span><span class="si">{</span><span class="p">[</span><span class="s1">&#39;entering&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;leaving&#39;</span><span class="p">][</span><span class="n">leaving</span><span class="p">]</span><span class="si">}</span><span class="s2"> surface &#39;</span><span class="si">{</span><span class="n">surfaceLabel</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;of solid &#39;</span><span class="si">{</span><span class="n">solidLabel</span><span class="si">}</span><span class="s2">&#39;. The 3D data was discarded and no stored 2D view corresponds &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;to this surface.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_getSurfaceStats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">SurfaceStats</span><span class="p">]:</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">surfaceLabel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">getSeenSurfaceLabels</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">):</span>
            <span class="n">stats</span><span class="p">[</span><span class="n">surfaceLabel</span><span class="p">]</span> <span class="o">=</span> <span class="n">SurfaceStats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTransmittance</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">,</span> <span class="n">surfaceLabel</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">stats</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getTransmittance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">surfaceLabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">useTotalEnergy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Uses local energy input for the desired solid by default. Specify &#39;useTotalEnergy&#39; = True</span>
<span class="sd">        to compare instead with total input energy of the scene.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extractFromViews</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getTransmittanceFromViews</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">,</span> <span class="n">surfaceLabel</span><span class="p">,</span> <span class="n">useTotalEnergy</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">surfaceLabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getPointCloudOfSurfaces</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)</span><span class="o">.</span><span class="n">leavingSurfacePoints</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getPointCloud</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">,</span> <span class="n">surfaceLabel</span><span class="p">)</span><span class="o">.</span><span class="n">leavingSurfacePoints</span>

        <span class="n">energyInput</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergyInput</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">useTotalEnergy</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPhotonCount</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">100</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sumEnergy</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">/</span> <span class="n">energyInput</span> <span class="k">if</span> <span class="n">energyInput</span> <span class="k">else</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_getTransmittanceFromViews</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">surfaceLabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">useTotalEnergy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">surfaceLabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">energyLeaving</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getEnergyLeavingFromViews</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">energyLeaving</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSurfaceEnergyFromViews</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">,</span> <span class="n">surfaceLabel</span><span class="p">,</span> <span class="n">leaving</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">energyInput</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergyInput</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">useTotalEnergy</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPhotonCount</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">energyLeaving</span> <span class="o">/</span> <span class="n">energyInput</span> <span class="k">if</span> <span class="n">energyInput</span> <span class="k">else</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_sumEnergy</span><span class="p">(</span><span class="n">points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span> <span class="k">if</span> <span class="n">points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_getPointCloud</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">surfaceLabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PointCloud</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pointCloudFactory</span><span class="o">.</span><span class="n">getPointCloud</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">,</span> <span class="n">surfaceLabel</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_getPointCloudOfSurfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PointCloud</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pointCloudFactory</span><span class="o">.</span><span class="n">getPointCloudOfSurfaces</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_saveReport</span><span class="p">(</span><span class="n">report</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="s2">&quot;simulation_report&quot;</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: No filepath specified. Saving to </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">filepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">extension</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">extension</span> <span class="o">=</span> <span class="s2">&quot;txt&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
            <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">extension</span><span class="p">)):</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">extension</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
            <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="pytissueoptics.rayscattering.Stats.getTransmittance" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getTransmittance</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">,</span> <span class="n">surfaceLabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">useTotalEnergy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Uses local energy input for the desired solid by default. Specify 'useTotalEnergy' = True
to compare instead with total input energy of the scene.</p>


            <details class="quote">
              <summary>Source code in <code>pytissueoptics/rayscattering/statistics/statistics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">getTransmittance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solidLabel</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">surfaceLabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">useTotalEnergy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Uses local energy input for the desired solid by default. Specify &#39;useTotalEnergy&#39; = True</span>
<span class="sd">    to compare instead with total input energy of the scene.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extractFromViews</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getTransmittanceFromViews</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">,</span> <span class="n">surfaceLabel</span><span class="p">,</span> <span class="n">useTotalEnergy</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">surfaceLabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getPointCloudOfSurfaces</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)</span><span class="o">.</span><span class="n">leavingSurfacePoints</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getPointCloud</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">,</span> <span class="n">surfaceLabel</span><span class="p">)</span><span class="o">.</span><span class="n">leavingSurfacePoints</span>

    <span class="n">energyInput</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEnergyInput</span><span class="p">(</span><span class="n">solidLabel</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">useTotalEnergy</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPhotonCount</span><span class="p">()</span>
    <span class="k">return</span> <span class="mi">100</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sumEnergy</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">/</span> <span class="n">energyInput</span> <span class="k">if</span> <span class="n">energyInput</span> <span class="k">else</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pytissueoptics.rayscattering.ViewGroup" class="doc doc-heading">
            <code>ViewGroup</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Flag">Flag</span></code></p>


        <p>A ViewGroup is a bit Flag representing a group of 2D views. They can be combined with the <code>|</code> operator (bitwise OR).</p>


<details class="it-has-two-different-usages" open>
  <summary>It has two different usages</summary>
  <ol>
<li>Specify which default views to create when initializing an EnergyLogger, particularly when <code>keep3D</code> is False.</li>
<li>Specify which views to show during visualization.</li>
</ol>
</details>        <p>In the first use case, the default views created are three 2D projections of the whole scene (<code>SCENE</code>) or of each solid (<code>SOLIDS</code>) in every XYZ direction.
 Except for surface groups, where the default views created include a single 2D projection in the direction of the surface normal.
 <code>SURFACES_ENTERING</code> specifies the energy that entered the surface (energy direction opposite to the surface normal).</p>








              <details class="quote">
                <summary>Source code in <code>pytissueoptics/rayscattering/display/views/view2D.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ViewGroup</span><span class="p">(</span><span class="n">Flag</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A ViewGroup is a bit Flag representing a group of 2D views. They can be combined with the `|` operator (bitwise OR).</span>

<span class="sd">    It has two different usages:</span>
<span class="sd">        1. Specify which default views to create when initializing an EnergyLogger, particularly when `keep3D` is False.</span>
<span class="sd">        2. Specify which views to show during visualization.</span>

<span class="sd">    In the first use case, the default views created are three 2D projections of the whole scene (`SCENE`) or of each solid (`SOLIDS`) in every XYZ direction.</span>
<span class="sd">     Except for surface groups, where the default views created include a single 2D projection in the direction of the surface normal.</span>
<span class="sd">     `SURFACES_ENTERING` specifies the energy that entered the surface (energy direction opposite to the surface normal).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SCENE</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">SOLIDS</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">SURFACES_ENTERING</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">SURFACES_LEAVING</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">SURFACES</span> <span class="o">=</span> <span class="n">SURFACES_ENTERING</span> <span class="o">|</span> <span class="n">SURFACES_LEAVING</span>
    <span class="n">ALL</span> <span class="o">=</span> <span class="n">SCENE</span> <span class="o">|</span> <span class="n">SOLIDS</span> <span class="o">|</span> <span class="n">SURFACES</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pytissueoptics.rayscattering.Visibility" class="doc doc-heading">
            <code>Visibility</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="enum.Flag">Flag</span></code></p>


        <p>A Visibility is a bit Flag representing what to show inside a 3D visualization. They can be combined with the <code>|</code>
operator (bitwise OR). <code>AUTO</code> will automatically switch to DEFAULT_3D if 3D data is present, else DEFAULT_2D.</p>








              <details class="quote">
                <summary>Source code in <code>pytissueoptics/rayscattering/display/viewer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Visibility</span><span class="p">(</span><span class="n">Flag</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Visibility is a bit Flag representing what to show inside a 3D visualization. They can be combined with the `|`</span>
<span class="sd">    operator (bitwise OR). `AUTO` will automatically switch to DEFAULT_3D if 3D data is present, else DEFAULT_2D.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SCENE</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">SOURCE</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">POINT_CLOUD</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">VIEWS</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">DEFAULT_3D</span> <span class="o">=</span> <span class="n">SCENE</span> <span class="o">|</span> <span class="n">SOURCE</span> <span class="o">|</span> <span class="n">POINT_CLOUD</span>
    <span class="n">DEFAULT_2D</span> <span class="o">=</span> <span class="n">SCENE</span> <span class="o">|</span> <span class="n">SOURCE</span> <span class="o">|</span> <span class="n">VIEWS</span>
    <span class="n">AUTO</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>